<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
  <script src="../node_modules/web3/dist/web3.min.js"></script>
  <style>
    body {
      background-color: #F0F0F0;
      padding: 2em;
      font-family: 'Raleway', 'Source Sans Pro', 'Arial';
    }

    .container {
      width: 50%;
      margin: 0 auto;
    }

    label {
      display: block;
      margin-bottom: 10px;
    }

    input {
      padding: 10px;
      width: 50%;
      margin-bottom: 1em;
    }

    button {
      margin: 2em 0;
      padding: 1em 4em;
      display: block;
    }

    #instructor {
      padding: 1em;
      background-color: #fff;
      margin: 1em 0;
    }
  </style>



</head>

<body>
  <div class="container">

    <h1>Register</h1>

    <h2 id="data"></h2>

    <label for="name" class="col-lg-2 control-label">Name</label>
    <input id="name" type="text">

    <label for="age" class="col-lg-2 control-label">ID </label>
    <input id="age" type="text">

    <button id="button">Update</button>

    <label for="txhash" class="col-lg-2 control-label"></label>
    <h2 id="txhash"></h2>
  </div>

  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/ethereum/web3.js/dist/web3.min.js"></script>
  <script type = "module">
    // Our future code here..
    import {smartcontracts} from "../src/abi/smartcontracts.js";
    var web3;

    if (typeof web3 !== 'undefined') {
      web3 = new Web3(web3.currentProvider);
      
    } else {
      //web3 = new Web3(new Web3.providers.HttpProvider("http://127.0.0.1:9545"));
      web3 = new Web3(new Web3.providers.WebsocketProvider('ws://127.0.0.1:9545'));
    }
    //abi

    web3.eth.defaultAccount = web3.eth.accounts[0];

    var CoursetroContract = new web3.eth.Contract(smartcontracts.abi , smartcontracts.address);

    console.log(CoursetroContract);

    async function initContractLogic() {
      var currentAccounts = await web3.eth.getAccounts();
      // console.log(currentAccounts);
      $('#button').on('click', function () {
        console.log('click');
        var name = document.getElementById('name').value;
        var age = parseInt(document.getElementById('age').value);
        //alert(age);
        CoursetroContract.methods.setInstructor(name.trim(), age).send({
          from: currentAccounts[0]
        }).on('transactionHash', function (hash) {
          console.log('hash', hash);
          document.getElementById("txhash").innerHTML = hash;
        }).on('confirmation', function (confirmationNumber, receipt) {
          updateHtmlData();
        }).catch(function (error) {
          console.log(error, 'error');
        });

      
      });

      function updateHtmlData() {
        /*
        CoursetroContract.methods.getInstructor().call(function (error, result) {
          if (error) {
            console.log(error, 'error');
          } else {
            console.log(result, 'result');
            //$('#name').val(result[0]);
            //$('#age').val(result[1]);                

            // document.getElementById("data").innerhtml = name +" is "+ age;
            document.getElementById("data").innerHTML = result[0] + " is " + result[1];
          }
        });*/
       CoursetroContract.events.getInstructor(function(error,event){
          console.log(event);
          console.log(error);
          document.getElementById("data").innerHTML = event.returnValues[0] +"is"+ event.returnValues[1];
         
        });
        //CoursetroContract.events.getInstructor.returnValues['0'];

      }
      updateHtmlData();

    }
    initContractLogic();

  </script>

</body>

</html>